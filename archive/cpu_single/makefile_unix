CC = g++
CFLAGS = -O3 -Wall
TARGET = sort_benchmark
OUTPUT_FILE = hardware_specs.txt

all: $(TARGET)

$(TARGET): main.cpp
	@$(CC) $(CFLAGS) main.cpp -o $(TARGET)

# Target to generate the hardware specification file
hardware_spec:
	@echo "Gathering hardware specifications for Mac..."
	# Clear the output file if it exists, then add a header
	@echo "--- Hardware Specifications ---" > $(OUTPUT_FILE)

	# Get CPU and processor info (model, cores, speed)
	@echo "--- CPU/Processor Info ---" >> $(OUTPUT_FILE)
	# Model Name
	@sysctl -n machdep.cpu.brand_string | sed 's/^/Model Name: /' >> $(OUTPUT_FILE)
	# Total Number of Cores
	@sysctl -n machdep.cpu.core_count | sed 's/^/Total Cores: /' >> $(OUTPUT_FILE)
	# Logical Processors (Threads)
	@sysctl -n machdep.cpu.thread_count | sed 's/^/Logical Processors (Threads): /' >> $(OUTPUT_FILE)
	# Current CPU Frequency (Max)
	@sysctl -n hw.cpufrequency | awk '{print "Max CPU Frequency: " $0 " Hz"}' >> $(OUTPUT_FILE)
	@echo "" >> $(OUTPUT_FILE)

	# Get Memory Info
	@echo "--- Memory Info ---" >> $(OUTPUT_FILE)
	# Total Physical Memory (bytes) 1073741824
	@echo "" >> $(OUTPUT_FILE)
	@sysctl -n hw.memsize | awk '{printf "Total Physical Memory: %.2f GB\n", $$1/1073741824}' >> $(OUTPUT_FILE)
	@echo "Hardware specifications have been successfully saved to $(OUTPUT_FILE)"


bench: $(TARGET)
	@echo "Size,Bitonic(ms),StdSort(ms)" > result.csv
	@for n in 1024 2048 4096 8192 16384 32768 65536 131072 262144 524288 524288 2097152 4194304 8388608 16777216; do \
		echo "Running size $$n..."; \
		./$(TARGET) $$n >> result.csv; \
	done
	@echo "Benchmark complete. Results saved to result.csv"


clean:
	@rm -f $(TARGET) result.csv $(OUTPUT_FILE)